<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script type="text/javascript" src="config.js"></script>
</head>

<body>
    
    <div id="imports">&nbsp;</div>

    <script type="text/javascript">
        $(function(){
            $("#imports").load("imports.html");
        });
    </script>

    <!-- Rest of body goes here -->
    <div class="container">
        <div class="row">
                <h1>Overzicht Stoffen</h1>
                <p>Vragen worden gemaakt met willekeurige stoffen uit dit overzicht.</p>
        </div>
        <div class="row">
            <div class="col py-3">
                <button class="btn btn-primary" type="button" data-bs-toggle="modal" data-bs-target="#compoundModal">Stof Toevoegen</button>
                <button class="btn btn-primary" onclick="showCompounds()">Opnieuw Laden</button>
                <button class="btn btn-secondary" disabled>Hoe voeg ik formules toe?</button>
            </div>
        </div>
        <div class="row">
            <div id="allCompoundsTable"></div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="compoundModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title fs-5" id="exampleModalLabel">Stof toevoegen</h3>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <label for="name" class="form-label">Naam</label>
                        <input type="text" class="form-control" id="compoundName">
                        <label for="formula" class="form-label">Formule (HTML notatie)</label>
                        <input type="text" class="form-control" id="formula">
                        <label for="composition" class="form-label">Compositie</label>
                        <input type="text" class="form-control" id="composition">
                        <label for="molarMass" class="form-label" id="molarMass">Molmassa (g/mol)</label>
                        <input type="text" class="form-control" id="molarMass">
                        <label for="density" class="form-label">Dichtheid (kg/m3)</label>
                        <input type="text" class="form-control" id="density">
                        <label for="phase" class="form-label">Fase (bij 295 K)</label>
                        <select class="form-select" id="phase">
                            <option selected>g</option>
                            <option>l</option>
                            <option>s</option>
                        </select>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuleren</button>
                    <button type="button" class="btn btn-primary" id="submitButton" onclick="addCompound()">Toevoegen</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="container">
        <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4" style="border-top: 1px solid #b50d0d">
            <div class="col-md-4 d-flex align-items-center">
                <span class="mb-3 mb-md-0 text-body-secondary">Â© 2023 Molrekenaar - J. van den Berg</span>
            </div>
        </footer>
    </div>

    <!-- Other JS goes here -->
    <script>
        showCompounds();

        function addCompound() {
            console.log($("#compoundName").val());
        }

        async function showCompounds() {
            var allCompounds = await fetch(url + "allCompounds", {
                method: "GET",
            });
            allCompounds = await allCompounds.json();
            var insertable = `
                <table class="table">
                    <thead>
                        <tr>
                        <th> ID </th>
                        <th> Naam </th>
                        <th> Formule </th>
                        <th> Compositie </th>
                        <th> Molmassa (g/mol) </th>
                        <th> Dichtheid (kg/m<super>3</super>) </th>
                        <th> Fase (295K) </th>
                        </tr>
                    </thead>
                    <tbody>`;
            
            for (var i=0; i<allCompounds.length; i++) {
                insertable += "<tr><td>" + allCompounds[i].id + "</td>" +
                    "<td>" + allCompounds[i].name + "</td>" + 
                    "<td>" + allCompounds[i].htmlFormula +"</td>" +
                    "<td>" + allCompounds[i].composition + "</td>" + 
                    "<td>" + allCompounds[i].molarMass + "</td>" +
                    "<td>" + allCompounds[i].density + "</td>" +
                    "<td>" + allCompounds[i].phase + "</td>" +
                    "<td> <button onclick=deleteCompound("+allCompounds[i].id+")> Delete </button> </td>" +
                    "<td> <button onclick=updateCompound("+allCompounds[i].id+")> Update </button> </td>" +
                    "</tr>";
            }

            insertable += "</tbody> </table>";
            document.getElementById("allCompoundsTable").innerHTML = insertable;
        }

        async function testCompound() {
            var compound = {};
            compound.name = "methaan";
            compound.htmlFormula = "CH<sub>4</sub>";
            compound.composition = "C:1, H:4"
            compound.molarMass = 16.04;
            compound.density = 0.657; // kg/m3
            compound.phase = "g";

            console.log(compound);

            var response = await fetch(url + "addCompound", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(compound),
            });

            var result = await response;
            if (result.status == 200) {
                console.log("compound accepted, fetch completed")
            } else {
                console.log("problem in post request")
            }

        }

        async function deleteCompound(id) {

            await fetch(url + "deleteCompound", {
                method: "DELETE",
                headers:{
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(id),
            });

            showCompounds();

        }

    </script>
</body>

</html>